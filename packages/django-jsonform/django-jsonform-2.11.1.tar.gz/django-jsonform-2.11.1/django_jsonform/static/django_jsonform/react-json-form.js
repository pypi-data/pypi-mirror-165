!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-modal"),require("react-dom")):"function"==typeof define&&define.amd?define(["exports","react","react-modal","react-dom"],t):t((e||self).reactJsonForm={},e.React,e.ReactModal,e.ReactDOM)}(this,function(e,t,a,n){function r(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=/*#__PURE__*/r(t),i=/*#__PURE__*/r(a),o=/*#__PURE__*/r(n);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},s.apply(this,arguments)}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,d(e,t)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function u(e,t){if(null==e)return{};var a,n,r={},l=Object.keys(e);for(n=0;n<l.length;n++)t.indexOf(a=l[n])>=0||(r[a]=e[a]);return r}function m(e,t){var a={},n=e.keys||e.properties;for(var r in n){var l=n[r],i=l.hasOwnProperty("$ref");i&&(l=t(l.$ref));var o=l.type;"list"===o?o="array":"dict"===o&&(o="object"),a[r]="array"===o?i?[]:p(l,t):"object"===o?m(l,t):"boolean"===o?!1!==l.default&&(l.default||null):"integer"===o||"number"===o?0===l.default?0:l.default||null:l.default||""}return a}function p(e,t){var a=e.minItems||e.min_items||0;if(e.default&&e.default.length>=a)return e.default;var n=[];if(e.default&&(n=[].concat(e.default)),0===a)return n;e.items.hasOwnProperty("$ref")&&(e.items=t(e.items.$ref));var r=e.items.type;if("list"===r?r="array":"dict"===r&&(r="object"),"array"===r){for(;n.length<a;)n.push(p(e.items,t));return n}if("object"===r){for(;n.length<a;)n.push(m(e.items,t));return n}if("multiselect"===e.items.widget)return n;if("boolean"===r)for(;n.length<a;)n.push(!1!==e.items.default&&(e.items.default||null));else if("integer"===r||"number"===r)for(;n.length<a;)n.push(0===e.items.default?0:e.items.default||null);else for(;n.length<a;)n.push(e.items.default||"");return n}function f(e,t){e.hasOwnProperty("$ref")&&(e=t(e.$ref));var a=e.type;return"list"===a?a="array":"dict"===a&&(a="object"),"array"===a?p(e,t):"object"===a?m(e,t):"boolean"===a?!1!==e.default&&(e.default||null):"integer"===a||"number"===a?0===e.default?0:e.default||null:e.default||""}function h(e,t,a){var n=JSON.parse(JSON.stringify(e));t.items.hasOwnProperty("$ref")&&(t.items=a(t.items.$ref));var r=t.items.type,l=t.minItems||t.min_items||0;"list"===r?r="array":"dict"===r&&(r="object");for(var i="__JSONRORM_FILLER__";e.length<l;)e.push(i);for(var o=0;o<e.length;o++){var s=e[o];"array"===r?(s===i&&(s=[]),n[o]=h(s,t.items,a)):"object"===r?(s===i&&(s={}),n[o]=v(s,t.items,a)):s===i&&(n[o]="integer"===r||"number"===r?0===t.items.default?0:t.items.default||null:"boolean"===r?!1!==t.items.default&&(t.items.default||null):t.items.default||"")}return n}function v(e,t,a){for(var n=JSON.parse(JSON.stringify(e)),r=t.keys||t.properties,l=[].concat(Object.keys(r)),i=0;i<l.length;i++){var o=l[i],s=r[o];s.hasOwnProperty("$ref")&&(s=a(s.$ref));var c=s.type;"list"===c?c="array":"dict"===c&&(c="object"),e.hasOwnProperty(o)?"array"===c?n[o]=h(e[o],s,a):"object"===c?n[o]=v(e[o],s,a):""===e[o]?"integer"===c||"number"===c?n[o]=0===s.default?0:s.default||null:"boolean"===c&&(n[o]=!1!==s.default&&(s.default||null)):n[o]=e[o]:n[o]="array"===c?h([],s,a):"object"===c?v({},s,a):"boolean"===c?!1!==s.default&&(s.default||null):"integer"===c||"number"===c?0===s.default?0:s.default||null:s.default||""}return n}var g=["className"];function y(e){var t=e.className,a=u(e,g);t||(t="");var n=t.split(" ");t="";for(var r=0;r<n.length;r++)t=t+"rjf-"+n[r]+"-button ";/*#__PURE__*/return React.createElement("button",s({className:t.trim(),type:"button"},a),a.children)}function E(e){var t="rjf-loader";return e.className&&(t=t+" "+e.className),/*#__PURE__*/React.createElement("div",{className:t})}function b(e){var t;switch(e.name){case"chevron-up":t=/*#__PURE__*/React.createElement(N,null);break;case"chevron-down":t=/*#__PURE__*/React.createElement(j,null);break;case"arrow-down":t=/*#__PURE__*/React.createElement(k,null);break;case"x-lg":t=/*#__PURE__*/React.createElement(S,null)}/*#__PURE__*/return React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",className:"rjf-icon rjf-icon-"+e.name,viewBox:"0 0 16 16"},t)}function N(e){/*#__PURE__*/return React.createElement("path",{fillRule:"evenodd",d:"M7.646 4.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1-.708.708L8 5.707l-5.646 5.647a.5.5 0 0 1-.708-.708l6-6z"})}function j(e){/*#__PURE__*/return React.createElement("path",{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"})}function k(e){/*#__PURE__*/return React.createElement("path",{"fill-rule":"evenodd",d:"M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"})}function S(e){/*#__PURE__*/return React.createElement("path",{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"})}var w=/*#__PURE__*/function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).sendValue=function(e){t.props.onChange(e)},t.validateValue=function(e,t){return"hh"===e&&t<1?1:"hh"!==e&&t<0?0:"hh"===e&&t>12?12:"hh"!==e&&t>59?59:t},t.handleChange=function(e){var a,n=e.target.dataset.name,r=e.target.value;if(!isNaN(r)){var l=t.validateValue(n,parseInt(r)||0);"hh"!==n||"0"!==r&&""!==r&&"00"!==r||1!==l||(l=0),r.startsWith("0")&&l<10&&0!==l&&(l=l.toString().padStart(2,"0")),t.sendValue(((a={})[n]=""!==r?l.toString():"",a))}},t.handleKeyDown=function(e){var a;if(38===e.keyCode||40===e.keyCode){var n=e.target.dataset.name,r=parseInt(e.target.value)||0;38===e.keyCode?r++:40===e.keyCode&&r--,t.sendValue(((a={})[n]=t.validateValue(n,r).toString().padStart(2,"0"),a))}},t.handleSpin=function(e,a){var n,r=t.props[e];"ampm"===e?r="am"===r?"pm":"am":(r=parseInt(r)||0,"up"===a?r++:r--,r=t.validateValue(e,r).toString().padStart(2,"0")),t.sendValue(((n={})[e]=r,n))},t.handleBlur=function(e){var a,n=t.validateValue(e.target.dataset.name,parseInt(e.target.value)||0);n<10&&t.sendValue(((a={})[e.target.dataset.name]=n.toString().padStart(2,"0"),a))},t}c(t,e);var a=t.prototype;return a.componentWillUnmount=function(){var e={hh:this.validateValue("hh",this.props.hh).toString().padStart(2,"0"),mm:this.validateValue("mm",this.props.mm).toString().padStart(2,"0"),ss:this.validateValue("ss",this.props.ss).toString().padStart(2,"0")};this.sendValue(e)},a.render=function(){var e=this;/*#__PURE__*/return l.default.createElement("div",{className:"rjf-time-picker"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-row rjf-time-picker-labels"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},"Hrs"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},"Min"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},"Sec"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},"am/pm")),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-row"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("hh","up")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-up"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("mm","up")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-up"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("ss","up")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-up"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("ampm","up")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-up"})))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-row rjf-time-picker-values"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement("input",{type:"text","data-name":"hh",value:this.props.hh,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"},":"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement("input",{type:"text","data-name":"mm",value:this.props.mm,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"},":"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement("input",{type:"text","data-name":"ss",value:this.props.ss,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown})),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},this.props.ampm)),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-row"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("hh","down")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-down"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("mm","down")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-down"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("ss","down")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-down"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col rjf-time-picker-col-sm"}),/*#__PURE__*/l.default.createElement("div",{className:"rjf-time-picker-col"},/*#__PURE__*/l.default.createElement(y,{onClick:function(){return e.handleSpin("ampm","down")}},/*#__PURE__*/l.default.createElement(b,{name:"chevron-down"})))))},t}(l.default.Component),C=/*#__PURE__*/l.default.createContext();function R(e){return e?e.charAt(0).toUpperCase()+e.substr(1).toLowerCase():""}function O(e,t){return typeof e===t||("number"===t||"integer"===t?"string"==typeof e?""===(e=e.trim())?e=null:isNaN(Number(e))||(e=Number(e)):"boolean"==typeof e&&(e=!0===e?1:0):"boolean"===t&&(e="false"!==e&&!1!==e)),e}function _(){var e=document.cookie.split(";").filter(function(e){return 0===e.trim().indexOf("csrftoken=")});if(e.length)return e[0].split("=")[1];var t=document.querySelector('input[name="csrfmiddlewaretoken"]');return t?t.value:null}var x=["label","help_text","error","inputRef"],P=["label","help_text","error","value"],M=["label","help_text","error","value","options"],D=["label","help_text","error","value","options"],V=["label","value"],I=["label","help_text","error","inputRef"];function L(e){var t=e.label,a=e.help_text,n=e.inputRef,r=u(e,x);return"string"===r.type&&(r.type="text"),n&&(r.ref=n),null===r.value&&(r.value=""),/*#__PURE__*/l.default.createElement("div",null,t&&/*#__PURE__*/l.default.createElement("label",null,t),/*#__PURE__*/l.default.createElement("div",{className:"rjf-input-group"},/*#__PURE__*/l.default.createElement("input",r),a&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},a)))}function T(e){var t=e.label,a=e.help_text,n=e.value,r=u(e,P);return t||(t=r.name.toUpperCase()),"bool"===r.type&&(r.type="checkbox"),void 0===r.checked&&(r.checked=n),""!==r.checked&&null!=r.checked||(r.checked=!1),r.readOnly&&(r.disabled=!0),/*#__PURE__*/l.default.createElement("div",{className:"rjf-check-input"},/*#__PURE__*/l.default.createElement("label",null,/*#__PURE__*/l.default.createElement("input",r)," ",t),a&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},a))}function F(e){var t=e.label,a=e.help_text,n=e.value,r=e.options,i=u(e,M);return i.readOnly&&(i.disabled=!0),/*#__PURE__*/l.default.createElement("div",{className:"rjf-check-input"},/*#__PURE__*/l.default.createElement("label",null,t),r.map(function(e,t){var a,r;return"object"==typeof e?(a=e.label,r=e.value):("boolean"==typeof(a=e)&&(a=R(a.toString())),r=e),/*#__PURE__*/l.default.createElement("label",{key:a+"_"+r+"_"+t},/*#__PURE__*/l.default.createElement("input",s({},i,{value:r,checked:r===n}))," ",a)}),a&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},a))}function A(e){var t=e.label,a=e.help_text,n=e.value,r=e.options,i=u(e,D);return i.readOnly&&(i.disabled=!0),n||!1===n||0===n||(n=""),/*#__PURE__*/l.default.createElement("div",null,t&&/*#__PURE__*/l.default.createElement("label",null,t),/*#__PURE__*/l.default.createElement("div",{className:"rjf-input-group"},/*#__PURE__*/l.default.createElement("select",s({value:n},i),/*#__PURE__*/l.default.createElement("option",{disabled:!0,value:"",key:"__placehlder"},"Select..."),r.map(function(e,t){var a,n;return"object"==typeof e?(a=e.label,n=e.value):("boolean"==typeof(a=e)&&(a=R(a.toString())),n=e),/*#__PURE__*/l.default.createElement("option",{value:n,key:a+"_"+n+"_"+t},a)})),a&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},a)))}var $=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).handleChange=function(e){var t=[].concat(a.props.value),n=e.target.value;typeof n!==a.props.valueType&&(n=O(n,a.props.valueType)),e.target.checked?t.push(n):t=t.filter(function(e){return e!==n}),a.props.onChange({target:{type:a.props.type,value:t,name:a.props.name}})},a.showOptions=function(e){a.state.showOptions||a.setState({showOptions:!0})},a.hideOptions=function(e){a.setState({showOptions:!1})},a.toggleOptions=function(e){a.setState(function(e){return{showOptions:!e.showOptions}})},a.state={showOptions:!1},a.optionsContainer=/*#__PURE__*/l.default.createRef(),a.input=/*#__PURE__*/l.default.createRef(),a}return c(t,e),t.prototype.render=function(){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-multiselect-field"},/*#__PURE__*/l.default.createElement(L,{label:this.props.label,type:"text",value:this.props.value.length?this.props.value.length+" selected":"Select...",help_text:this.props.help_text,error:this.props.error,onClick:this.toggleOptions,readOnly:!0,inputRef:this.input,className:"rjf-multiselect-field-input"}),this.state.showOptions&&/*#__PURE__*/l.default.createElement(H,{options:this.props.options,value:this.props.value,hideOptions:this.hideOptions,onChange:this.handleChange,containerRef:this.optionsContainer,inputRef:this.input,disabled:this.props.readOnly,hasHelpText:this.props.help_text&&1}))},t}(l.default.Component),H=/*#__PURE__*/function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleClickOutside=function(e){!t.props.containerRef.current||t.props.containerRef.current.contains(e.target)||t.props.inputRef.current.contains(e.target)||t.props.hideOptions()},t}c(t,e);var a=t.prototype;return a.componentDidMount=function(){document.addEventListener("mousedown",this.handleClickOutside)},a.componentWillUnmount=function(){document.removeEventListener("mousedown",this.handleClickOutside)},a.render=function(){var e=this;/*#__PURE__*/return l.default.createElement("div",{ref:this.props.containerRef},/*#__PURE__*/l.default.createElement("div",{className:"rjf-multiselect-field-options-container",style:this.props.hasHelpText?{marginTop:"-15px"}:{}},this.props.options.map(function(t,a){var n,r;"object"==typeof t?(n=t.label,r=t.value):("boolean"==typeof(n=t)&&(n=R(n.toString())),r=t);var i=e.props.value.indexOf(r)>-1,o="rjf-multiselect-field-option";return i&&(o+=" selected"),e.props.disabled&&(o+=" disabled"),/*#__PURE__*/l.default.createElement("div",{key:n+"_"+r+"_"+a,className:o},/*#__PURE__*/l.default.createElement("label",null,/*#__PURE__*/l.default.createElement("input",{type:"checkbox",onChange:e.props.onChange,value:r,checked:i,disabled:e.props.disabled})," ",n))})))},t}(l.default.Component),J=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).getFileName=function(){return a.props.value?"data-url"===a.props.type?a.extractFileInfo(a.props.value).name:"file-url"===a.props.type?a.props.value:"Unknown file":""},a.extractFileInfo=function(e){var t=function(e){var t,a=e.split(","),n=a[0].split(";"),r=n[0].replace("data:",""),l=n.filter(function(e){return"name"===e.split("=")[0]});t=1!==l.length?"unknown":l[0].split("=")[1];for(var i=atob(a[1]),o=[],s=0;s<i.length;s++)o.push(i.charCodeAt(s));return{blob:new window.Blob([new Uint8Array(o)],{type:r}),name:t}}(e),a=t.blob;return{name:t.name,size:a.size,type:a.type}},a.addNameToDataURL=function(e,t){return e.replace(";base64",";name="+encodeURIComponent(t)+";base64")},a.handleChange=function(e){if("data-url"===a.props.type){var t=e.target.files[0],n=t.name,r=new FileReader;r.onload=function(){var e={target:{type:"text",value:a.addNameToDataURL(r.result,n),name:a.props.name}};a.props.onChange(e)},r.readAsDataURL(t)}else if("file-url"===a.props.type){var l=a.props.handler||a.context.fileHandler;if(!l)return console.error("Error: fileHandler option need to be passed while initializing editor for enabling file uploads."),void alert("Files couldn't be uploaded.");a.setState({loading:!0});var i=new FormData;i.append("field_name",a.context.fieldName),i.append("model_name",a.context.modelName),i.append("coordinates",JSON.stringify(a.props.name.split("-").slice(1))),i.append("file",e.target.files[0]),fetch(l,{method:"POST",headers:{"X-CSRFToken":_()},body:i}).then(function(e){return e.json()}).then(function(e){a.props.onChange({target:{type:"text",value:e.value,name:a.props.name}}),a.setState({loading:!1})}).catch(function(e){alert("Something went wrong while uploading file"),console.error("Error:",e),a.setState({loading:!1})})}},a.showFileBrowser=function(){a.inputRef.current.click()},a.clearFile=function(){window.confirm("Do you want to remove this file?")&&(a.props.onChange({target:{type:"text",value:"",name:a.props.name}}),a.inputRef.current&&(a.inputRef.current.value=""))},a.state={value:t.value,fileName:a.getFileName(),loading:!1},a.inputRef=/*#__PURE__*/l.default.createRef(),a}c(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){this.props.value!==e.value&&this.setState({value:this.props.value,fileName:this.getFileName()})},a.render=function(){var e=s({value:a},this.props),t=e.label,a=e.value,n=u(e,V);return n.type="file",n.onChange=this.handleChange,n.readOnly&&(n.disabled=!0),/*#__PURE__*/l.default.createElement("div",null,t&&/*#__PURE__*/l.default.createElement("label",null,t),/*#__PURE__*/l.default.createElement("div",{className:"rjf-file-field"},this.state.value&&/*#__PURE__*/l.default.createElement("div",{className:"rjf-current-file-name"},"Current file: ",/*#__PURE__*/l.default.createElement("span",null,this.state.fileName)," "," ",/*#__PURE__*/l.default.createElement(y,{className:"remove-file",onClick:this.clearFile},"Clear")),this.state.value&&!this.state.loading&&"Change:",this.state.loading?/*#__PURE__*/l.default.createElement("div",{className:"rjf-file-field-loading"},/*#__PURE__*/l.default.createElement(E,null)," Uploading..."):/*#__PURE__*/l.default.createElement("div",{className:"rjf-file-field-input"},/*#__PURE__*/l.default.createElement(L,s({},n,{inputRef:this.inputRef})))))},t}(l.default.Component);J.contextType=C;var U=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).handleChange=function(e){a.updateHeight(e.target),a.props.onChange&&a.props.onChange(e)},a.updateHeight=function(e){var t=e.offsetHeight-e.clientHeight;e.style.height="auto",e.style.height=e.scrollHeight+t+"px"},t.inputRef||(a.inputRef=/*#__PURE__*/l.default.createRef()),a}c(t,e);var a=t.prototype;return a.componentDidMount=function(){this.updateHeight(this.props.inputRef?this.props.inputRef.current:this.inputRef.current)},a.render=function(){var e=this.props,t=e.label,a=e.help_text,n=e.inputRef,r=u(e,I);return delete r.type,r.ref=n||this.inputRef,r.onChange=this.handleChange,/*#__PURE__*/l.default.createElement("div",null,t&&/*#__PURE__*/l.default.createElement("label",null,t),/*#__PURE__*/l.default.createElement("div",{className:"rjf-input-group"},/*#__PURE__*/l.default.createElement("textarea",r),a&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},a)))},t}(l.default.Component),B=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).getStateFromProps=function(){var e="",t="12",n="00",r="00",l="000",i="am";if(a.props.value){var o=new Date(a.props.value);e=o.getFullYear().toString().padStart(2,"0")+"-"+(o.getMonth()+1).toString().padStart(2,"0")+"-"+o.getDate().toString().padStart(2,"0"),0===(t=o.getHours())?t=12:12===t?i="pm":t>12&&(t-=12,i="pm"),n=o.getMinutes(),r=o.getSeconds(),l=o.getMilliseconds(),t=t.toString().padStart(2,"0"),n=n.toString().padStart(2,"0"),r=r.toString().padStart(2,"0")}return{date:e,hh:t,mm:n,ss:r,ms:l,ampm:i}},a.handleClickOutside=function(e){a.state.showTimePicker&&(!a.timePickerContainer.current||a.timePickerContainer.current.contains(e.target)||a.timeInput.current.contains(e.target)||a.setState({showTimePicker:!1}))},a.sendValue=function(){var e={target:{type:"text",value:"",name:a.props.name}};if(""===a.state.date||null===a.state.date)return a.props.onChange(e);var t=parseInt(a.state.hh);0===t&&(t=NaN),"am"===a.state.ampm?12===t&&(t=0):"pm"===a.state.ampm&&12!==t&&(t+=12),t=t.toString().padStart(2,"0");var n=a.state.mm.padStart(2,"0"),r=a.state.ss.padStart(2,"0");try{var l=new Date(a.state.date+"T"+t+":"+n+":"+r+"."+a.state.ms);e.target.value=l.toISOString().replace("Z","+00:00")}catch(t){return a.props.onChange(e)}a.props.onChange(e)},a.handleDateChange=function(e){a.setState({date:e.target.value},a.sendValue)},a.handleTimeChange=function(e){a.setState(s({},e),a.sendValue)},a.showTimePicker=function(){a.setState({showTimePicker:!0})},a.state=s({},a.getStateFromProps(),{showTimePicker:!1}),a.timeInput=/*#__PURE__*/l.default.createRef(),a.timePickerContainer=/*#__PURE__*/l.default.createRef(),a}c(t,e);var a=t.prototype;return a.componentDidUpdate=function(e,t){if(e.value!==this.props.value&&""!==this.state.hh&&"0"!==this.state.hh&&"00"!==this.state.hh){var a=!1,n=this.getStateFromProps();for(var r in n)if(n[r]!==this.state[r]){a=!0;break}a&&this.setState(s({},n))}},a.componentDidMount=function(){document.addEventListener("mousedown",this.handleClickOutside)},a.componentWillUnmount=function(){document.removeEventListener("mousedown",this.handleClickOutside)},a.render=function(){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-datetime-field"},this.props.label&&/*#__PURE__*/l.default.createElement("label",null,this.props.label),/*#__PURE__*/l.default.createElement("div",{className:"rjf-datetime-field-inner"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-datetime-field-inputs"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-datetime-field-date"},/*#__PURE__*/l.default.createElement(L,{label:"Date",type:"date",value:this.state.date,onChange:this.handleDateChange})),/*#__PURE__*/l.default.createElement("div",{className:"rjf-datetime-field-time"},/*#__PURE__*/l.default.createElement(L,{label:"Time",type:"text",value:this.state.hh+":"+this.state.mm+":"+this.state.ss+" "+this.state.ampm,onFocus:this.showTimePicker,readOnly:!0,inputRef:this.timeInput}),/*#__PURE__*/l.default.createElement("div",{ref:this.timePickerContainer},this.state.showTimePicker&&/*#__PURE__*/l.default.createElement(w,{onChange:this.handleTimeChange,hh:this.state.hh,mm:this.state.mm,ss:this.state.ss,ampm:this.state.ampm})))),this.props.help_text&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},this.props.help_text)))},t}(l.default.Component);function K(e){return e.children?/*#__PURE__*/l.default.createElement("div",{className:"rjf-form-group-title"},e.editable?/*#__PURE__*/l.default.createElement("span",null,e.children," ",/*#__PURE__*/l.default.createElement(y,{className:"edit",onClick:e.onEdit,title:"Edit"},"Edit")):e.children):null}function z(e,t,a){var n=e.target.parentElement.parentElement,r=n.previousElementSibling,l=n.nextElementSibling;if(n.classList.add("rjf-animate","rjf-"+t),"move-up"===t){var i=r.getBoundingClientRect().y,o=i,s=i=n.getBoundingClientRect().y;r.classList.add("rjf-animate"),r.style.opacity=0,r.style.transform="translateY("+(s-o)+"px)",n.style.opacity=0,n.style.transform="translateY(-"+(s-o)+"px)"}else if("move-down"===t){var c=n.getBoundingClientRect().y,d=c,u=c=l.getBoundingClientRect().y;l.classList.add("rjf-animate"),l.style.opacity=0,l.style.transform="translateY(-"+(u-d)+"px)",n.style.opacity=0,n.style.transform="translateY("+(u-d)+"px)"}setTimeout(function(){a(),n.classList.remove("rjf-animate","rjf-"+t),n.style=null,"move-up"===t?(r.classList.remove("rjf-animate"),r.style=null):"move-down"===t&&(l.classList.remove("rjf-animate"),l.style=null)},200)}function W(e){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-form-row-controls"},e.onMoveUp&&/*#__PURE__*/l.default.createElement(y,{className:"move-up",onClick:function(t){return z(t,"move-up",e.onMoveUp)},title:"Move up"},/*#__PURE__*/l.default.createElement("span",null,"↑")),e.onMoveDown&&/*#__PURE__*/l.default.createElement(y,{className:"move-down",onClick:function(t){return z(t,"move-down",e.onMoveDown)},title:"Move down"},/*#__PURE__*/l.default.createElement("span",null,"↓")),e.onRemove&&/*#__PURE__*/l.default.createElement(y,{className:"remove",onClick:function(t){return z(t,"remove",e.onRemove)},title:"Remove"},/*#__PURE__*/l.default.createElement("span",null,"×")))}function q(e){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-form-row"},/*#__PURE__*/l.default.createElement(W,e),/*#__PURE__*/l.default.createElement("div",{className:"rjf-form-row-inner"},e.children))}function Y(e){var t=l.default.Children.count(e.children),a=0!==e.level||t?"rjf-form-group-inner":"";/*#__PURE__*/return l.default.createElement("div",{className:"rjf-form-group"},0===e.level&&/*#__PURE__*/l.default.createElement(K,{editable:e.editable,onEdit:e.onEdit},e.schema.title),/*#__PURE__*/l.default.createElement("div",{className:a},e.level>0&&/*#__PURE__*/l.default.createElement(K,{editable:e.editable,onEdit:e.onEdit},e.schema.title),e.children,e.addable&&/*#__PURE__*/l.default.createElement(y,{className:"add",onClick:function(t){return e.onAdd()},title:"object"===e.schema.type?"Add new key":"Add new item"},"object"===e.schema.type?"Add key":"Add item")))}var Z=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).openModal=function(e){a.setState({open:!0})},a.closeModal=function(e){a.setState({open:!1,pane:"upload"})},a.togglePane=function(e){a.setState({pane:e})},a.handleFileSelect=function(e){a.props.onChange({target:{type:"text",value:e,name:a.props.name}}),a.closeModal()},a.handleFileUpload=function(e){a.props.onChange(e),a.closeModal()},a.clearFile=function(){window.confirm("Do you want to remove this file?")&&a.props.onChange({target:{type:"text",value:"",name:a.props.name}})},a.state={value:t.value,loading:!1,open:!1,pane:"upload"},a.inputRef=/*#__PURE__*/l.default.createRef(),a}return c(t,e),t.prototype.render=function(){return this.props.handler||this.context.fileHandler?/*#__PURE__*/l.default.createElement("div",null,this.props.label&&/*#__PURE__*/l.default.createElement("label",null,this.props.label),/*#__PURE__*/l.default.createElement("div",{className:"rjf-file-field"},this.props.value&&/*#__PURE__*/l.default.createElement("div",{className:"rjf-current-file-name"},"Current file: ",/*#__PURE__*/l.default.createElement("span",null,this.props.value)," "," ",/*#__PURE__*/l.default.createElement(y,{className:"remove-file",onClick:this.clearFile},"Clear")),/*#__PURE__*/l.default.createElement(y,{onClick:this.openModal,className:"upload-modal__open"},this.props.value?"Change file":"Select file"),this.props.help_text&&/*#__PURE__*/l.default.createElement("span",{className:"rjf-help-text"},this.props.help_text)),/*#__PURE__*/l.default.createElement(i.default,{isOpen:this.state.open,onRequestClose:this.closeModal,contentLabel:"Select file",portalClassName:"rjf-modal-portal",overlayClassName:"rjf-modal__overlay",className:"rjf-modal__dialog",bodyOpenClassName:"rjf-modal__main-body--open",closeTimeoutMS:150,ariaHideApp:!1},/*#__PURE__*/l.default.createElement("div",{className:"rjf-modal__content"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-modal__header"},/*#__PURE__*/l.default.createElement(G,{onClick:this.togglePane,tabName:"upload",active:"upload"===this.state.pane},"Upload new")," ",/*#__PURE__*/l.default.createElement(G,{onClick:this.togglePane,tabName:"library",active:"library"===this.state.pane},"Choose from library"),/*#__PURE__*/l.default.createElement(y,{className:"modal__close",onClick:this.closeModal,title:"Close (Esc)"},/*#__PURE__*/l.default.createElement(b,{name:"x-lg"}))),/*#__PURE__*/l.default.createElement("div",{className:"rjf-modal__body"},"upload"===this.state.pane&&/*#__PURE__*/l.default.createElement(X,s({},this.props,{onChange:this.handleFileUpload,label:"",value:"",help_text:""})),"library"===this.state.pane&&/*#__PURE__*/l.default.createElement(Q,{fileHandler:this.props.handler||this.context.fileHandler,fileHandlerArgs:{field_name:this.context.fieldName,model_name:this.context.modelName,coordinates:JSON.stringify(this.props.name.split("-").slice(1))},onFileSelect:this.handleFileSelect})),/*#__PURE__*/l.default.createElement("div",{className:"rjf-modal__footer"},/*#__PURE__*/l.default.createElement(y,{className:"modal__footer-close",onClick:this.closeModal},"Cancel"))))):/*#__PURE__*/l.default.createElement(J,this.props)},t}(l.default.Component);function G(e){var t="rjf-upload-modal__tab-button";return e.active&&(t+=" rjf-upload-modal__tab-button--active"),/*#__PURE__*/l.default.createElement("button",{onClick:function(){return e.onClick(e.tabName)},className:t},e.children)}function X(e){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-upload-modal__pane"},/*#__PURE__*/l.default.createElement("h3",null,"Upload new"),/*#__PURE__*/l.default.createElement("br",null),/*#__PURE__*/l.default.createElement(J,e))}Z.contextType=C;var Q=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).fetchList=function(){var e=a.props.fileHandler;if(!e)return console.error("Error: fileHandler option need to be passed while initializing editor for enabling file listing."),void a.setState({loading:!1,hasMore:!1});var t=e+"?"+new URLSearchParams(s({},a.props.fileHandlerArgs,{page:a.state.page+1}));fetch(t,{method:"GET"}).then(function(e){return e.json()}).then(function(e){Array.isArray(e.results)||(e.results=[]),a.setState(function(t){return{loading:!1,files:[].concat(t.files,e.results),page:e.results.length>0?t.page+1:t.page,hasMore:e.results.length>0}})}).catch(function(e){alert("Something went wrong while retrieving media files"),console.error("Error:",e),a.setState({loading:!1})})},a.onLoadMore=function(e){a.setState({loading:!0},a.fetchList)},a.state={loading:!0,files:[],page:0,hasMore:!0},a}c(t,e);var a=t.prototype;return a.componentDidMount=function(){this.fetchList()},a.render=function(){var e=this;/*#__PURE__*/return l.default.createElement("div",{className:"rjf-upload-modal__pane"},/*#__PURE__*/l.default.createElement("h3",null,"Media library"),/*#__PURE__*/l.default.createElement("div",{className:"rjf-upload-modal__media-container"},this.state.files.map(function(t){/*#__PURE__*/return l.default.createElement(ee,s({},t,{onClick:e.props.onFileSelect}))})),this.state.loading&&/*#__PURE__*/l.default.createElement(E,{className:"rjf-upload-modal__media-loader"}),!this.state.loading&&this.state.hasMore&&/*#__PURE__*/l.default.createElement("div",null,/*#__PURE__*/l.default.createElement(y,{onClick:this.onLoadMore,className:"upload-modal__media-load"},/*#__PURE__*/l.default.createElement(b,{name:"arrow-down"})," View more")),!this.state.hasMore&&/*#__PURE__*/l.default.createElement("div",{className:"rjf-upload-modal__media-end-message"},this.state.files.length?"End of list":"No files found"))},t}(l.default.Component);function ee(e){var t=e.metadata||{};/*#__PURE__*/return l.default.createElement("div",{className:"rjf-upload-modal__media-tile"},/*#__PURE__*/l.default.createElement("div",{className:"rjf-upload-modal__media-tile-inner",tabIndex:"0",onClick:function(){return e.onClick(e.value)}},/*#__PURE__*/l.default.createElement("img",{src:e.thumbnail?e.thumbnail:"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%23999999' viewBox='0 0 16 16'%3E%3Cpath d='M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zm-3 0A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5h-2z'/%3E%3C/svg%3E"}),e.metadata&&/*#__PURE__*/l.default.createElement("div",{className:"rjf-upload-modal__media-tile-metadata"},Object.getOwnPropertyNames(t).map(function(e){/*#__PURE__*/return l.default.createElement("span",null,t[e])}))))}var te=["data","schema","name","onChange","onRemove","removable","onEdit","onKeyEdit","editable","onMoveUp","onMoveDown","parentType"];function ae(e){var t={name:e.name,value:e.data,readOnly:e.schema.readOnly||e.schema.readonly,help_text:e.schema.help_text||e.schema.helpText};e.schema.placeholder&&(t.placeholder=e.schema.placeholder),e.schema.handler&&(t.handler=e.schema.handler);var a,n=e.schema.type,r=e.schema.choices||e.schema.enum;switch(r&&(t.options=r,n="select"),e.schema.widget&&("multiselect"===e.schema.widget&&"array"!==e.parentType||(n=e.schema.widget)),n){case"string":a=L,e.schema.format?("data-url"===e.schema.format?a=J:"file-url"===e.schema.format?a=Z:"datetime"!==e.schema.format&&"date-time"!==e.schema.format||(a=B),t.type=e.schema.format):t.type="text";break;case"number":t.type="number",a=L;break;case"integer":t.type="number",t.step="1",a=L;break;case"boolean":case"checkbox":t.type="checkbox",a=T;break;case"radio":t.type="radio",a=F;break;case"select":a=A;break;case"multiselect":t.valueType=e.schema.type,a=$;break;case"textarea":a=U;break;default:t.type="text",a=L}/*#__PURE__*/return React.createElement(a,s({},t,{label:e.editable?/*#__PURE__*/React.createElement("span",null,e.schema.title," ",/*#__PURE__*/React.createElement(y,{className:"edit",onClick:e.onEdit,title:"Edit"},"Edit")):e.schema.title,onChange:function(t){return function(e,t,a){var n;n="checkbox"===e.target.type?e.target.checked:e.target.value,n=Array.isArray(n)?n.map(function(e){return O(e,t)}):O(n,t),a(e.target.name,n)}(t,e.schema.type,e.onChange)}}))}function ne(e){var t=e.data,a=e.schema,n=e.name,r=e.onChange,l=e.onRemove,i=e.removable,o=e.onKeyEdit,c=e.editable,d=e.onMoveUp,m=e.onMoveDown,p=e.parentType,f=u(e,te);/*#__PURE__*/return React.createElement(q,{key:n,onRemove:i?function(e){return l(n)}:null,onMoveUp:d,onMoveDown:m},/*#__PURE__*/React.createElement(ae,s({data:t,schema:a,name:n,onChange:r,onEdit:o,editable:c,parentType:p},f)))}function re(e){var t=e.data,a=e.schema,n=e.name,r=e.onChange,l=e.onAdd,i=e.onRemove,o=e.onMove,s=e.onEdit,c=e.level,d=[],u=[],m=!0;t.length<=(a.min_items||a.minItems||0)&&(m=!1);var p=!0;t.length>=(a.max_items||a.maxItems||100)&&(p=!1),a.items.hasOwnProperty("$ref")&&(a.items=e.getRef(a.items.$ref));var h=a.items.type;"list"===h?h="array":"dict"===h&&(h="object");var v={schema:a.items,onChange:r,onAdd:l,onRemove:i,level:c+1,removable:m,onMove:o,onEdit:s,onKeyEdit:e.onKeyEdit,parentType:"array",getRef:e.getRef};if("multiselect"===v.schema.widget)v.data=t,v.name=n,v.removable=!1,v.onMoveUp=null,v.onMoveDown=null,p=!1,d.push(ne(v));else for(var g=function(e){v.data=t[e],v.name=n+"-"+e,v.onMoveUp=0===e?null:function(t){return o(n+"-"+e,n+"-"+(e-1))},v.onMoveDown=e===t.length-1?null:function(t){return o(n+"-"+e,n+"-"+(e+1))},"array"===h?u.push(re(v)):"object"===h?u.push(le(v)):d.push(ne(v))},E=0;E<t.length;E++)g(E);var b=n;if((d.length||!d.length&&!u.length)&&(d=/*#__PURE__*/React.createElement(Y,{level:c,schema:a,addable:p,onAdd:function(){return l(f(a.items,e.getRef),b)},editable:e.editable,onEdit:e.onKeyEdit,key:"row_group_"+n},d),"object"===e.parentType&&e.removable&&(d=/*#__PURE__*/React.createElement("div",{className:"rjf-form-group-wrapper",key:"row_group_wrapper_"+n},/*#__PURE__*/React.createElement(W,{onRemove:function(e){return i(n)}}),d))),u.length){var N=a.title?/*#__PURE__*/React.createElement(K,{editable:e.editable,onEdit:e.onKeyEdit},a.title):null;u=/*#__PURE__*/React.createElement("div",{key:"group_"+n,className:"rjf-form-group-wrapper"},"object"===e.parentType&&e.removable&&/*#__PURE__*/React.createElement(W,{onRemove:function(e){return i(n)}}),/*#__PURE__*/React.createElement("div",{className:"rjf-form-group"},/*#__PURE__*/React.createElement("div",{className:c>0?"rjf-form-group-inner":""},N,u.map(function(e,t){/*#__PURE__*/return React.createElement("div",{className:"rjf-form-group-wrapper",key:"group_wrapper_"+n+"_"+t},/*#__PURE__*/React.createElement(W,{onRemove:m?function(e){return i(n+"-"+t)}:null,onMoveUp:t>0?function(e){return o(n+"-"+t,n+"-"+(t-1))}:null,onMoveDown:t<u.length-1?function(e){return o(n+"-"+t,n+"-"+(t+1))}:null}),e)}),p&&/*#__PURE__*/React.createElement(y,{className:"add",onClick:function(t){return l(f(a.items,e.getRef),b)},title:"Add new item"},"Add item"))))}return[].concat(d,u)}function le(e){var t=e.data,a=e.schema,n=e.name,r=e.onChange,l=e.onAdd,i=e.onRemove,o=e.onMove,c=e.onEdit,d=e.level,u=[],m=a.keys||a.properties,p=[].concat(Object.keys(m));a.additionalProperties&&(p=[].concat(p,Object.keys(t).filter(function(e){return-1===p.indexOf(e)})));for(var h=function(f){var h=p[f],v=t[h],g=n+"-"+h,y=m.hasOwnProperty(h)?s({},m[h]):void 0;void 0===y&&(y="boolean"==typeof a.additionalProperties?{type:"string"}:s({},a.additionalProperties));var E=y.hasOwnProperty("$ref");E&&(y=e.getRef(y.$ref));var b=y.type;"list"===b?b="array":"dict"===b&&(b="object"),(!y.title||E&&a.additionalProperties)&&(y.title=function(e){return null==e?"":R(e=e.replace(/_/g," "))}(h));var N=!1;void 0===m[h]&&(N=!0);var j={data:v,schema:y,name:g,onChange:r,onAdd:l,onRemove:i,level:d+1,removable:N,onMove:o,onEdit:c,parentType:"object",getRef:e.getRef,onKeyEdit:function(){return function(e,t,a,n,r){var l=prompt("Rename key",t);if(null!==l&&(l=l.trim())!==t){if(!l)return alert("(!) Key name can't be empty.\r\n\r\n‎");if(e.hasOwnProperty(l))return alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎");var i=n.split("-");i.pop(),i.push(l),r(a,i=i.join("-"),n)}}(t,h,v,g,c)}};j.editable=N,u.push("array"===b?re(j):"object"===b?le(j):ne(j))},v=0;v<p.length;v++)h(v);if(u.length||a.additionalProperties){var g=n;u=/*#__PURE__*/React.createElement(Y,{level:d,schema:a,addable:a.additionalProperties,onAdd:function(){return function(e,t,a,n,r){var l=prompt("Add new key");null!==l&&(!0===n&&(n={type:"string"}),(l=l.trim())?e.hasOwnProperty(l)?alert("(!) Duplicate keys not allowed. This key already exists.\r\n\r\n‎"):a(f(n,r),t+"-"+l):alert("(!) Can't add empty key.\r\n\r\n‎"))}(t,g,l,a.additionalProperties,e.getRef)},editable:e.editable,onEdit:e.onKeyEdit,key:"row_group_"+n},u),"object"===e.parentType&&e.removable&&(u=/*#__PURE__*/React.createElement("div",{className:"rjf-form-group-wrapper",key:"row_group_wrapper_"+n},/*#__PURE__*/React.createElement(W,{onRemove:function(e){return i(n)}}),u))}return u}function ie(e){if(!(e instanceof Object))return{isValid:!1,msg:"Schema must be an object"};var t,a=de(e.type);return(t="object"===a?oe(e):"array"===a?se(e):{isValid:!1,msg:"Outermost schema can only be of type array, list, object or dict"}).isValid&&e.hasOwnProperty("$defs")&&!e.$defs instanceof Object?{isValid:!1,msg:"'$defs' must be a valid JavaScript Object"}:t}function oe(e){if(!e.hasOwnProperty("keys")&&!e.hasOwnProperty("properties"))return{isValid:!1,msg:"Schema of type '"+e.type+"' must have a key called 'properties' or 'keys'"};var t=e.properties||e.keys;if(!(t instanceof Object))return{isValid:!1,msg:"The 'keys' or 'properties' key must be a valid JavaScript Object"};for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];if(!(n instanceof Object))return{isValid:!1,msg:"Key '"+a+"' must be a valid JavaScript Object"};var r={isValid:!0},l=de(n.type);if(l?"object"===l?r=oe(n):"array"===l&&(r=se(n)):r=n.hasOwnProperty("$ref")?ce(n):{isValid:!1,msg:"Key '"+a+"' must have a 'type' or a '$ref"},!r.isValid)return r}if(e.hasOwnProperty("additionalProperties")){if(!(e.additionalProperties instanceof Object)&&"boolean"!=typeof e.additionalProperties)return{isValid:!1,msg:"'additionalProperties' must be either a JavaScript boolean or a JavaScript object"};if(e.additionalProperties instanceof Object)if(e.additionalProperties.hasOwnProperty("$ref")){if(validation=ce(e.additionalProperties),!validation.isValid)return validation}else{var i=de(e.additionalProperties.type);if("object"===i)return oe(e.additionalProperties);if("array"===i)return ie(e.additionalProperties)}}return{isValid:!0,msg:""}}function se(e){if(!e.hasOwnProperty("items"))return{isValid:!1,msg:"Schema of type '"+e.type+"' must have a key called 'items'"};if(!(e.items instanceof Object))return{isValid:!1,msg:"The 'items' key must be a valid JavaScript Object'"};var t=de(e.items.type);return t?"object"===t?oe(e.items):"array"===t?se(e.items):{isValid:!0,msg:""}:e.items.hasOwnProperty("$ref")?ce(e.items):{isValid:!1,msg:"'items' key must have a 'type' or a '$ref'"}}function ce(e){return"string"!=typeof e.$ref?{isValid:!1,msg:"'$ref' keyword must be a string"}:e.$ref.startsWith("#")?e.$ref.lenght>1&&!e.$ref.startsWith("#/")?{isValid:!1,msg:"Invalid '$ref' path"}:{isValid:!0,msg:""}:{isValid:!1,msg:"'$ref' value must begin with a hash (#) character"}}function de(e){switch(e){case"list":return"array";case"dict":return"object";case"keys":return"properties";case"choices":return"enum";default:return e}}var ue=/*#__PURE__*/function(){function e(e){this.state=e}e.create=function(t,a){"string"==typeof t&&(t=JSON.parse(t));var n=ie(t);if(!n.isValid)throw new Error("Error while creating EditorState: Invalid schema: "+n.msg);if("string"==typeof a&&""!==a&&(a=JSON.parse(a)),a)try{a=function(e,t,a){t.hasOwnProperty("$ref")&&(t=a(t.$ref));var n=t.type;return"list"===n?n="array":"dict"===n&&(n="object"),"array"===n?h(e,t,a):"object"===n?v(e,t,a):e}(a,t,function(a){return e.getRef(a,t)})}catch(e){console.error("Error while creating EditorState: Schema and data structure don't match"),console.error(e)}else a=f(t,function(a){return e.getRef(a,t)});return new e({schema:t,data:a})},e.getRef=function(e,t){for(var a,n=e.split("/"),r=0;r<n.length;r++){var l=n[r];a="#"===l?t:a[l]}return s({},a)},e.update=function(t,a){return new e(s({},t._getState(),{data:a}))};var t=e.prototype;return t._getState=function(){return this.state},t.getData=function(){return this._getState().data},t.getSchema=function(){return this._getState().schema},e}(),me=/*#__PURE__*/function(e){function t(){for(var t,a=arguments.length,n=new Array(a),r=0;r<a;r++)n[r]=arguments[r];return(t=e.call.apply(e,[this].concat(n))||this).handleChange=function(e,a){(e=e.split("-")).shift();var n=pe(e,JSON.parse(JSON.stringify(t.props.editorState.getData())),a);t.props.onChange(ue.update(t.props.editorState,n))},t.getRef=function(e){return ue.getRef(e,t.props.editorState.getSchema())},t.getFields=function(){var e=t.props.editorState.getData(),a=t.props.editorState.getSchema(),n=[];try{var r=a.type;"list"===r?r="array":"dict"===r&&(r="object");var i={data:e,schema:a,name:"rjf",onChange:t.handleChange,onAdd:t.addFieldset,onRemove:t.removeFieldset,onEdit:t.editFieldset,onMove:t.moveFieldset,level:0,getRef:t.getRef};if("array"===r)return re(i);if("object"===r)return le(i)}catch(e){console.log(e),n=/*#__PURE__*/l.default.createElement("p",{style:{color:"#f00"}},/*#__PURE__*/l.default.createElement("strong",null,"(!) Error:")," Schema and data structure do not match.")}return n},t.addFieldset=function(e,a){(a=a.split("-")).shift();var n=fe(a,JSON.parse(JSON.stringify(t.props.editorState.getData())),e);t.props.onChange(ue.update(t.props.editorState,n))},t.removeFieldset=function(e){(e=e.split("-")).shift();var a=he(e,JSON.parse(JSON.stringify(t.props.editorState.getData())));t.props.onChange(ue.update(t.props.editorState,a))},t.editFieldset=function(e,a,n){(a=a.split("-")).shift(),(n=n.split("-")).shift();var r=fe(a,JSON.parse(JSON.stringify(t.props.editorState.getData())),e);r=he(n,r),t.props.onChange(ue.update(t.props.editorState,r))},t.moveFieldset=function(e,a){(e=e.split("-")).shift(),(a=a.split("-")).shift();var n=ve(e,a,JSON.parse(JSON.stringify(t.props.editorState.getData())));t.props.onChange(ue.update(t.props.editorState,n))},t}return c(t,e),t.prototype.render=function(){/*#__PURE__*/return l.default.createElement("div",{className:"rjf-form-wrapper"},/*#__PURE__*/l.default.createElement("fieldset",{className:"module aligned"},/*#__PURE__*/l.default.createElement(C.Provider,{value:{fileHandler:this.props.fileHandler,fieldName:this.props.fieldName,modelName:this.props.modelName}},this.getFields())))},t}(l.default.Component);function pe(e,t,a){var n=e.shift();return isNaN(Number(n))||(n=Number(n)),e.length?t[n]=pe(e,t[n],a):void 0===n?t=a:t[n]=a,t}function fe(e,t,a){var n=e.shift();return isNaN(Number(n))||(n=Number(n)),e.length?t[n]=fe(e,t[n],a):Array.isArray(t[n])?t[n].push(a):Array.isArray(t)?t.push(a):t[n]=a,t}function he(e,t){var a=e.shift();return isNaN(Number(a))||(a=Number(a)),e.length?he(e,t[a]):Array.isArray(t)?t.splice(a,1):delete t[a],t}function ve(e,t,a){var n=e.shift();if(isNaN(Number(n))||(n=Number(n)),e.length)ve(e,t,a[n]);else if(Array.isArray(a)){var r=t[t.length-1],l=a[n];a.splice(n,1),a.splice(r,0,l)}return a}function ge(e){this.containerId=e.containerId,this.dataInputId=e.dataInputId,this.schema=e.schema,this.data=e.data,this.fileHandler=e.fileHandler,this.fieldName=e.fieldName,this.modelName=e.modelName,this.eventListeners=null,this.addEventListener=function(e,t){null===this.eventListeners&&(this.eventListeners={}),this.eventListeners.hasOwnProperty(e)||(this.eventListeners[e]=new Set),this.eventListeners[e].add(t)},this.onChange=function(e){this.eventListeners&&this.eventListeners.hasOwnProperty("change")&&this.eventListeners.change.size&&this.eventListeners.change.forEach(function(t){return t(e)})},this.onChange=this.onChange.bind(this),this.render=function(){try{o.default.render(/*#__PURE__*/l.default.createElement(Ee,{schema:this.schema,dataInputId:this.dataInputId,data:this.data,fileHandler:this.fileHandler,fieldName:this.fieldName,modelName:this.modelName,onChange:this.onChange}),document.getElementById(this.containerId))}catch(e){o.default.render(/*#__PURE__*/l.default.createElement(be,{error:e}),document.getElementById(this.containerId))}},this.update=function(e){this.schema=e.schema||this.schema,this.data=e.data||this.data,this.render()}}var ye={},Ee=/*#__PURE__*/function(e){function t(t){var a;return(a=e.call(this,t)||this).populateDataInput=function(e){a.dataInput.value=JSON.stringify(e)},a.handleChange=function(e){a.setState({editorState:e})},a.state={editorState:ue.create(t.schema,t.data)},a.prevEditorState=a.state.editorState,a.dataInput=document.getElementById(t.dataInputId),a}c(t,e);var a=t.prototype;return a.componentDidMount=function(){this.populateDataInput(this.state.editorState.getData())},a.componentDidUpdate=function(e,t){if(this.props.schema===e.schema)this.props.data===e.data?(this.state.editorState!==t.editorState&&this.populateDataInput(this.state.editorState.getData()),this.props.onChange&&this.state.editorState!==t.editorState&&this.props.onChange({schema:this.state.editorState.getSchema(),data:this.state.editorState.getData(),prevSchema:t.editorState.getSchema(),prevData:t.editorState.getData()})):this.setState({editorState:ue.update(this.state.editorState,this.props.data)});else{var a=this.props.schema,n=this.props.data!==e.data?this.props.data:this.state.editorState.getData();this.setState({editorState:ue.create(a,n)})}},a.render=function(){/*#__PURE__*/return l.default.createElement(me,{editorState:this.state.editorState,onChange:this.handleChange,fileHandler:this.props.fileHandler,fieldName:this.props.fieldName,modelName:this.props.modelName})},t}(l.default.Component);function be(e){/*#__PURE__*/return l.default.createElement("div",{style:{color:"#f00"}},/*#__PURE__*/l.default.createElement("p",null,"(!) ",e.error.toString()),/*#__PURE__*/l.default.createElement("p",null,"Check browser console for more details about the error."))}e.EditorState=ue,e.ReactJSONForm=me,e.createForm=function(e){var t=new ge(e);return ye[e.containerId]=t,t},e.getFormInstance=function(e){return ye[e]}});
